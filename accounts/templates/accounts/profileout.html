<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: #f4f4f4;
            border-bottom: 1px solid #ccc;
        }

        header button {
            margin: 0 5px;
        }

        main {
            padding: 20px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .profile-header img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-right: 20px;
        }

        .profile-header div {
            font-size: 18px;
        }
    </style>
</head>

<body>
    <header>
        <div>
            <a href="/"><button>메인</button></a>
            <span>시간</span>
        </div>
        <div>
            <button id="edit-profile-btn">프로필 수정</button>
            <button id="logout-btn">로그아웃</button>
        </div>
    </header>
    <main>
        <div class="profile-header">
            <!-- <img src="profile-placeholder.png" alt="프로필 사진" id="profile_image"> -->
            <div>
                <p id="username"></p>
                <p id="email"></p>
                <p id="bot_list"></p>
                <p id="article_like"></p>
                <p id="comment_like"></p>
                <p id="bot_Conversation_List"></p>
            </div>
        </div>
    </main>
    <script>
        function getCookie(name) {
            let value = `; ${document.cookie}`;
            let parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        window.onload = function () {
            fetchProfile();
        };

        // 프로필 정보 GET 요청
        function fetchProfile() {
            const token = getCookie('access_token');  // 쿠키에서 access_token을 가져옴

            if (!token) {
                console.error('토큰이 없습니다. 로그인을 먼저 해주세요.');
                window.location.href = '/login';  // 토큰이 없으면 로그인 페이지로 리다이렉트
                return;
            }

            fetch('/accounts/profile/api', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + token  // Authorization 헤더에 Bearer 토큰 추가
                }
            })
                .then(response => {
                    if (!response.ok) throw new Error("Failed to fetch profile data");
                    return response.json();
                })
                .then(data => {
                    document.getElementById('username').textContent = `${data.username}님 반갑습니다!`;
                    document.getElementById('useremail').textContent = `이메일: ${data.email}`;
                    // document.getElementById('profile_image').src = data.profile_image || "profile-placeholder.png";
                    document.getElementById('Favorite_articles').textContent = `${data.Favorite_articles}`;
                    document.getElementById('Favorite_comments').textContent = `${data.Favorite_comments}`;
                    document.getElementById('Favorite_articles').textContent = `${data.bot_Conversation_List}`;
                })

        }

        // 프로필 수정 버튼 클릭 시
        document.getElementById('edit-profile-btn').onclick = function () {
            window.location.href = '/accounts/profileedit/';  // 프로필 수정 페이지로 이동
        };

        // 로그아웃 버튼 클릭 시
        document.getElementById('logout-btn').onclick = function () {
            // 로그아웃 처리 (로컬 스토리지에서 토큰 삭제)
            localStorage.removeItem('access_token');
            window.location.href = '/';  // 로그아웃 후 메인 페이지로 이동
        };
    </script>
</body>

</html>